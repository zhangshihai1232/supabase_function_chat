# è½»é‡çº§æ¶æ„è¿ç§»è¯´æ˜

## æ¦‚è¿°

æˆåŠŸå°†èŠå¤©æœåŠ¡ä»Oakæ¡†æ¶è¿ç§»åˆ°è½»é‡çº§æ¶æ„ï¼Œå»æ‰äº†æ‰€æœ‰å¤–éƒ¨Webæ¡†æ¶ä¾èµ–ï¼Œä½¿æœåŠ¡èƒ½å¤Ÿæ›´å¥½åœ°é€‚é…Supabase Edge Functionså’Œæœ¬åœ°Denoç¯å¢ƒã€‚

## ä¸»è¦å˜æ›´

### 1. æ¶æ„ç®€åŒ–
- **ç§»é™¤ä¾èµ–**: å®Œå…¨å»æ‰Oakæ¡†æ¶ä¾èµ–
- **åŸç”Ÿå®ç°**: ä½¿ç”¨DenoåŸç”ŸHTTPæœåŠ¡å™¨
- **è½»é‡çº§**: å‡å°‘äº†ä»£ç å¤æ‚åº¦å’Œè¿è¡Œæ—¶å¼€é”€

### 2. æ–‡ä»¶å˜æ›´

#### æ–°å¢/ä¿®æ”¹æ–‡ä»¶:
- `supabase/functions/chat/index.ts` - å…¨æ–°è½»é‡çº§å…¥å£æ–‡ä»¶
- `supabase/functions/_shared/types.ts` - æ›´æ–°ç±»å‹å®šä¹‰ï¼Œå¢åŠ ç¼ºå¤±å­—æ®µ

#### å·²åˆ é™¤çš„åºŸå¼ƒæ–‡ä»¶:
- `supabase/functions/chat/oak-router.ts` - Oakè·¯ç”±å™¨ï¼ˆå·²åˆ é™¤ï¼‰
- `supabase/functions/chat/server-startup.ts` - å¯åŠ¨å·¥å…·ï¼ˆå·²åˆ é™¤ï¼‰

#### ä¿æŒä¸å˜:
- `supabase/functions/chat/chat-service.ts` - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- `supabase/functions/chat/http-responses.ts` - HTTPå“åº”å¤„ç†
- `supabase/functions/_shared/` - æ‰€æœ‰å…±äº«å·¥å…·å’Œç±»å‹
- `start-deno.sh` - å¯åŠ¨è„šæœ¬ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

### 3. åŠŸèƒ½ç‰¹æ€§

#### âœ… ä¿æŒå®Œæ•´åŠŸèƒ½
- Google Gemini AI é›†æˆ
- æµå¼å“åº” (SSE)
- CORS æ”¯æŒ
- åŒ¿åç”¨æˆ·æ¨¡å¼
- å†…å­˜å­˜å‚¨å¯¹è¯è®°å½•
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### ğŸš€ æ–°å¢ç‰¹æ€§
- æ›´å¥½çš„Supabase Edge Functionså…¼å®¹æ€§
- æ›´å¿«çš„å¯åŠ¨æ—¶é—´
- æ›´ä½çš„å†…å­˜å ç”¨
- ç®€åŒ–çš„è·¯ç”±å¤„ç†

## ä½¿ç”¨æ–¹æ³•

### æœ¬åœ°å¼€å‘
```bash
# æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./start-deno.sh

# æ–¹æ³•2: ç›´æ¥ä½¿ç”¨Deno
deno run --allow-net --allow-env --allow-read supabase/functions/chat/index.ts
```

### Supabaseéƒ¨ç½²
æ–°ç‰ˆæœ¬å®Œå…¨å…¼å®¹Supabase Edge Functionsï¼Œå¯ä»¥ç›´æ¥éƒ¨ç½²ï¼š
```bash
supabase functions deploy chat
```

## APIç«¯ç‚¹

æœåŠ¡æä¾›ä»¥ä¸‹ç«¯ç‚¹ï¼š

- `GET /` - é‡å®šå‘åˆ°çŠ¶æ€é¡µé¢
- `GET /status` - æœåŠ¡çŠ¶æ€ä¿¡æ¯
- `GET /chat/status` - èŠå¤©æœåŠ¡çŠ¶æ€
- `GET /chat` - èŠå¤©æœåŠ¡ä¿¡æ¯
- `POST /chat` - å‘é€èŠå¤©æ¶ˆæ¯
- `OPTIONS *` - CORSé¢„æ£€è¯·æ±‚

## æµ‹è¯•éªŒè¯

### çŠ¶æ€æŸ¥è¯¢æµ‹è¯•
```bash
curl http://localhost:8000/status
```

### æ ‡å‡†èŠå¤©æµ‹è¯•
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½"}'
```

### æµå¼å“åº”æµ‹è¯•
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½", "stream": true}' \
  --no-buffer
```

## è¿ç§»ä¼˜åŠ¿

1. **æ€§èƒ½æå‡**: å»æ‰æ¡†æ¶å¼€é”€ï¼Œå¯åŠ¨æ›´å¿«ï¼Œå†…å­˜å ç”¨æ›´å°‘
2. **å…¼å®¹æ€§**: æ›´å¥½åœ°æ”¯æŒSupabase Edge Functions
3. **ç»´æŠ¤æ€§**: ä»£ç æ›´ç®€æ´ï¼Œä¾èµ–æ›´å°‘
4. **å¯é æ€§**: å‡å°‘äº†æ½œåœ¨çš„ä¾èµ–å†²çªé—®é¢˜
5. **çµæ´»æ€§**: æ›´å®¹æ˜“å®šåˆ¶å’Œæ‰©å±•

## å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šåˆ°Oakç‰ˆæœ¬ï¼š
1. ä»Gitå†å²ä¸­æ¢å¤ `oak-router.ts` å’Œ `server-startup.ts` æ–‡ä»¶
2. ä¿®æ”¹ `index.ts` é‡æ–°å¼•å…¥Oakä¾èµ–å’Œè·¯ç”±å™¨
3. æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œå…±äº«æ¨¡å—ä¿æŒä¸å˜

**æ³¨æ„**: åºŸå¼ƒæ–‡ä»¶å·²è¢«åˆ é™¤ï¼Œéœ€è¦ä»ç‰ˆæœ¬æ§åˆ¶å†å²ä¸­æ¢å¤

## æ³¨æ„äº‹é¡¹

- ç¯å¢ƒå˜é‡è®¾ç½®ä¿æŒä¸å˜
- æ‰€æœ‰APIæ¥å£ä¿æŒå®Œå…¨å…¼å®¹
- æµ‹è¯•ç”¨ä¾‹æ— éœ€ä¿®æ”¹
- ç°æœ‰å®¢æˆ·ç«¯ä»£ç æ— éœ€æ›´æ”¹
